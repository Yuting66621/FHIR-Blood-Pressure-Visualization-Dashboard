<!DOCTYPE html>
<html>

<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FHIR Blood Pressure </title>

  <style>
    
  </style>

  
</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>

<div id="container" style="width:100%; height:300px;"></div>


  <script>
    
function handleData(data) {

  
  var c = [];
  var dSystolic = [];
  var dDiastolic = [];

  for (var i=0;i<data.entry.length;i++) {
    c.push(data.entry[i].resource.effectiveDateTime.substring(0,10));
    dSystolic.push(data.entry[i].resource.component[0].valueQuantity.value);
    dDiastolic.push(data.entry[i].resource.component[1].valueQuantity.value);
  }
  
  console.log(c)
  console.log(dSystolic)
  console.log(dDiastolic)
  
  var myChartOptions = {
    chart: {
      type: 'line'
    },
    title: {
      text: 'Blood Pressure Over Time'
    },
    xAxis: {
      categories: c
    },
    yAxis: {
      title: {
        text: 'mmHg'
      }
    },
    // 2 dimensions: 
    series: [{
      data: dSystolic, 
      name:"Systolic"
    },
    {
      data:dDiastolic,
      name:"Diastolic"
    }]
  }

  Highcharts.chart('container', myChartOptions);
}

const client = FHIR.client("https://r3.smarthealthit.org");
client.request("Observation?code=http://loinc.org|55284-4&_sort=date&patient=d2fd4a58-b2c1-4078-ae3f-8ccdc5430bea")
  .then(handleData)
  .catch(console.error)
  ;





  </script>
</body>
</html>
